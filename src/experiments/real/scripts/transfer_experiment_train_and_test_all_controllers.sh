#!/bin/bash

source scripts/array_to_string_functions.sh


COMPILE_JOB_ID=`sbatch --parsable scripts/make_hip.sh --exclude=n[001-004,017-018]`

SRCDIR=`pwd`


OPTIMIZATION_TIME=0.1

if false; then
echo "this part not executed"
# ... Code I want to skip here ...
fi






######################## REAL TRANSFER #################################
EXPERIMENT_FOLDER_NAME="src/experiments/real/results/transferability"
COMPUTE_RESPONSE="true"
SCORE_PATH="${EXPERIMENT_FOLDER_NAME}/transfer_score.txt"
RESPONSE_PATH="${EXPERIMENT_FOLDER_NAME}/transfer_response.txt"
TMP_RES_PATH="${SRCDIR}/tmp/${EXPERIMENT_FOLDER_NAME}"
N_REPS=1
N_EVALS=1000


standard_NEAT_POPSIZE=128
standard_NLO=20
standard_DIM=10
standard_SOLVER_POPSIZE=20
standard_MAX_SOLVER_FE=10000
########################################################################





###########################################################################################################################
EXP_NAME="NLO"
NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()


i=-1
for NLO_train in 1 4 16 64; do
    i=$((i+1))

    NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
    CONTROLLER_NAME_PREFIX_ARRAY+=("NLO_${NLO_train}")
    EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
    SEED_ARRAY+=("${i}")
    PROBLEM_NLO_ARRAY+=("${NLO_train}")
    PROBLEM_DIM_ARRAY+=("${standard_DIM}")
    SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
    MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
done




NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")



TRAINING_JOB_ID=`sbatch --parsable --dependency=afterok:${COMPILE_JOB_ID} --export=NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_train_array.sl`



TESTING_JOB_ID=""


NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()
i=-1
for NLO_train in 1 4 16 64; do
    for NLO_test in 1 4 16 64; do
        i=$((i+1))

        NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
        CONTROLLER_NAME_PREFIX_ARRAY+=("NLO_${NLO_train}")
        EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
        SEED_ARRAY+=("${i}")
        PROBLEM_NLO_ARRAY+=("${NLO_test}")
        PROBLEM_DIM_ARRAY+=("${standard_DIM}")
        SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
        MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
    done
done

NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")

TESTING_JOB_ID=`sbatch --parsable --dependency=afterok:${TRAINING_JOB_ID} --export=EXPERIMENT_FOLDER_NAME=${EXPEIMENT_FOLDER_NAME},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},TMP_RES_PATH=${TMP_RES_PATH},N_REPS=${N_REPS},N_EVALS=${N_EVALS},EXP_NAME=${EXP_NAME},NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_test_array.sl`


sbatch --dependency=afterok:$TESTING_JOB_ID --export=SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},TMP_RES_PATH=${TMP_RES_PATH} scripts/cat_result_files_to_exp_folder.sh



###########################################################################################################################



EXP_NAME="DIM"
NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()


i=-1
for DIM_train in 1 8 64; do
    i=$((i+1))

    NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
    CONTROLLER_NAME_PREFIX_ARRAY+=("DIM_${DIM_train}")
    EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
    SEED_ARRAY+=("${i}")
    PROBLEM_NLO_ARRAY+=("${standard_NLO}")
    PROBLEM_DIM_ARRAY+=("${DIM_train}")
    SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
    MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
done




NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")



TRAINING_JOB_ID=`sbatch --parsable --dependency=afterok:${COMPILE_JOB_ID} --export=NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_train_array.sl`



TESTING_JOB_ID=""


NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()
i=-1
for DIM_train in 1 8 64; do
    for DIM_test in 1 8 64; do
        i=$((i+1))

        NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
        CONTROLLER_NAME_PREFIX_ARRAY+=("DIM_${DIM_train}")
        EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
        SEED_ARRAY+=("${i}")
        PROBLEM_NLO_ARRAY+=("${standard_NLO}")
        PROBLEM_DIM_ARRAY+=("${DIM_test}")
        SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
        MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
    done
done

NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")

TESTING_JOB_ID=`sbatch --parsable --dependency=afterok:${TRAINING_JOB_ID} --export=EXPERIMENT_FOLDER_NAME=${EXPEIMENT_FOLDER_NAME},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},TMP_RES_PATH=${TMP_RES_PATH},N_REPS=${N_REPS},N_EVALS=${N_EVALS},EXP_NAME=${EXP_NAME},NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_test_array.sl`


sbatch --dependency=afterok:$TESTING_JOB_ID --export=SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},TMP_RES_PATH=${TMP_RES_PATH} scripts/cat_result_files_to_exp_folder.sh



###########################################################################################################################



EXP_NAME="POPSIZE"
NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()


i=-1
for SOLVER_POPSIZE_train in 10 40 160; do
    i=$((i+1))

    NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
    CONTROLLER_NAME_PREFIX_ARRAY+=("POPSIZE_${SOLVER_POPSIZE_train}")
    EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
    SEED_ARRAY+=("${i}")
    PROBLEM_NLO_ARRAY+=("${standard_NLO}")
    PROBLEM_DIM_ARRAY+=("${standard_DIM}")
    SOLVER_POPSIZE_ARRAY+=("${SOLVER_POPSIZE_train}")
    MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
done




NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")



TRAINING_JOB_ID=`sbatch --parsable --dependency=afterok:${COMPILE_JOB_ID} --export=NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_train_array.sl`



TESTING_JOB_ID=""


NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()
i=-1
for SOLVER_POPSIZE_train in 10 40 160; do
    for SOLVER_POPSIZE_test in 10 40 160; do
        i=$((i+1))

        NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
        CONTROLLER_NAME_PREFIX_ARRAY+=("POPSIZE_${SOLVER_POPSIZE_train}")
        EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
        SEED_ARRAY+=("${i}")
        PROBLEM_NLO_ARRAY+=("${standard_NLO}")
        PROBLEM_DIM_ARRAY+=("${standard_DIM}")
        SOLVER_POPSIZE_ARRAY+=("${SOLVER_POPSIZE_test}")
        MAX_SOLVER_FE_ARRAY+=("${standard_MAX_SOLVER_FE}")
    done
done

NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")

TESTING_JOB_ID=`sbatch --parsable --dependency=afterok:${TRAINING_JOB_ID} --export=EXPERIMENT_FOLDER_NAME=${EXPEIMENT_FOLDER_NAME},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},TMP_RES_PATH=${TMP_RES_PATH},N_REPS=${N_REPS},N_EVALS=${N_EVALS},EXP_NAME=${EXP_NAME},NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_test_array.sl`


sbatch --dependency=afterok:$TESTING_JOB_ID --export=SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},TMP_RES_PATH=${TMP_RES_PATH} scripts/cat_result_files_to_exp_folder.sh



###########################################################################################################################



EXP_NAME="MAX_SOLVER_FE"
NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()


i=-1
for MAX_SOLVER_FE_train in 1000 5000 25000 125000; do
    i=$((i+1))

    NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
    CONTROLLER_NAME_PREFIX_ARRAY+=("MAX_SOLVER_FE_${MAX_SOLVER_FE_train}")
    EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
    SEED_ARRAY+=("${i}")
    PROBLEM_NLO_ARRAY+=("${standard_NLO}")
    PROBLEM_DIM_ARRAY+=("${standard_DIM}")
    SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
    MAX_SOLVER_FE_ARRAY+=("${MAX_SOLVER_FE_train}")
done




NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")



TRAINING_JOB_ID=`sbatch --parsable --dependency=afterok:${COMPILE_JOB_ID} --export=NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_train_array.sl`



TESTING_JOB_ID=""


NEAT_POPSIZE_ARRAY=()
CONTROLLER_NAME_PREFIX_ARRAY=()
EXPERIMENT_FOLDER_NAME_ARRAY=()
SEED_ARRAY=()
PROBLEM_NLO_ARRAY=()
PROBLEM_DIM_ARRAY=()
SOLVER_POPSIZE_ARRAY=()
MAX_SOLVER_FE_ARRAY=()
i=-1
for MAX_SOLVER_FE_train in 1000 5000 25000 125000; do
    for MAX_SOLVER_FE_test in 1000 5000 25000 125000; do
        i=$((i+1))

        NEAT_POPSIZE_ARRAY+=("${standard_NEAT_POPSIZE}")
        CONTROLLER_NAME_PREFIX_ARRAY+=("MAX_SOLVER_FE_${MAX_SOLVER_FE_train}")
        EXPERIMENT_FOLDER_NAME_ARRAY+=("${EXPERIMENT_FOLDER_NAME}")
        SEED_ARRAY+=("${i}")
        PROBLEM_NLO_ARRAY+=("${standard_NLO}")
        PROBLEM_DIM_ARRAY+=("${standard_DIM}")
        SOLVER_POPSIZE_ARRAY+=("${standard_SOLVER_POPSIZE}")
        MAX_SOLVER_FE_ARRAY+=("${MAX_SOLVER_FE_test}")
    done
done

NEAT_POPSIZE_ARRAY=$(to_list "${NEAT_POPSIZE_ARRAY[@]}")
CONTROLLER_NAME_PREFIX_ARRAY=$(to_list "${CONTROLLER_NAME_PREFIX_ARRAY[@]}")
EXPERIMENT_FOLDER_NAME_ARRAY=$(to_list "${EXPERIMENT_FOLDER_NAME_ARRAY[@]}")
SEED_ARRAY=$(to_list "${SEED_ARRAY[@]}")
PROBLEM_NLO_ARRAY=$(to_list "${PROBLEM_NLO_ARRAY[@]}")
PROBLEM_DIM_ARRAY=$(to_list "${PROBLEM_DIM_ARRAY[@]}")
SOLVER_POPSIZE_ARRAY=$(to_list "${SOLVER_POPSIZE_ARRAY[@]}")
MAX_SOLVER_FE_ARRAY=$(to_list "${MAX_SOLVER_FE_ARRAY[@]}")

TESTING_JOB_ID=`sbatch --parsable --dependency=afterok:${TRAINING_JOB_ID} --export=EXPERIMENT_FOLDER_NAME=${EXPEIMENT_FOLDER_NAME},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},TMP_RES_PATH=${TMP_RES_PATH},N_REPS=${N_REPS},N_EVALS=${N_EVALS},EXP_NAME=${EXP_NAME},NEAT_POPSIZE_ARRAY=$NEAT_POPSIZE_ARRAY,CONTROLLER_NAME_PREFIX_ARRAY=$CONTROLLER_NAME_PREFIX_ARRAY,EXPERIMENT_FOLDER_NAME_ARRAY=$EXPERIMENT_FOLDER_NAME_ARRAY,SEED_ARRAY=$SEED_ARRAY,PROBLEM_NLO_ARRAY=$PROBLEM_NLO_ARRAY,PROBLEM_DIM_ARRAY=$PROBLEM_DIM_ARRAY,SOLVER_POPSIZE_ARRAY=$SOLVER_POPSIZE_ARRAY,MAX_SOLVER_FE_ARRAY=$MAX_SOLVER_FE_ARRAY --array=0-$i src/experiments/real/scripts/hip_test_array.sl`


sbatch --dependency=afterok:$TESTING_JOB_ID --export=SCORE_PATH=${SCORE_PATH},RESPONSE_PATH=${RESPONSE_PATH},COMPUTE_RESPONSE=${COMPUTE_RESPONSE},TMP_RES_PATH=${TMP_RES_PATH} scripts/cat_result_files_to_exp_folder.sh


